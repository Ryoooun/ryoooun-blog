---
// import BaseLayout from "../../layouts/BaseLayout.astro";
import BaseHead from "../../components/BaseHead.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import FormattedDate from "../../components/FormattedDate.astro";

import { getBlogs, getBlogDetail } from "../../library/microcms";

import {load} from "cheerio"
import hljs from 'highlight.js'
import "highlight.js/styles/atom-one-dark-reasonable.css"


export async function getStaticPaths() {
  const response = await getBlogs({ fields: ["id"] });
  return response.contents.map((content: any) => ({
    params: {
      blogId: content.id,
    },
  }));
}

const { blogId } = Astro.params;
const blog = await getBlogDetail(blogId as string);

const $ = load(blog.content);
$("pre code").each((_, elm) => {
  const result = hljs.highlightAuto($(elm).text())
  $(elm).html(result.value)
  $(elm).addClass("javascript hljs")
})
---

<BaseHead title={blog.title} description="blog" />
<Header />
<img src={blog.eyecatch?.url ? blog.eyecatch.url : ""} alt={blog.title} />
<h1>{blog.title}</h1>
<time datetime={blog.publishedAt}>
  {new Date(blog.publishedAt).toLocaleDateString("ja-JP")}
</time>
<p>
  最終更新日：<time datetime={blog.publishedAt}>
    {new Date(blog.publishedAt).toLocaleDateString("ja-JP")}
  </time>
</p>
<hr />
<main set:html={$.html()} />
<Footer />
<style lang="scss">
  img {
    width: 100%;
    height: auto;
  }
</style>
