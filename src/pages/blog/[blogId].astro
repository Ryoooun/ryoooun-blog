---
// import BaseLayout from "../../layouts/BaseLayout.astro";
import BaseHead from "../../components/BaseHead.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import FormattedDate from "../../components/FormattedDate.astro";
import Breadcrumbs from "../../components/util/atoms/Breadcrumb.astro"
import BaseLayout from "../../layouts/BaseLayout.astro"

import { getBlogs, getBlogDetail } from "../../library/microcms";

import {load} from "cheerio"
import hljs from 'highlight.js'
import "highlight.js/styles/atom-one-dark-reasonable.css"


export async function getStaticPaths() {
  const response = await getBlogs({ fields: ["id"] });
  return response.contents.map((content: any) => ({
    params: {
      blogId: content.id,
    },
  }));
}

const { blogId } = Astro.params;
const blog = await getBlogDetail(blogId as string);

const $ = load(blog.content);
$("pre code").each((_, elm) => {
  const result = hljs.highlightAuto($(elm).text())
  $(elm).html(result.value)
  $(elm).addClass("javascript hljs")
  $(elm).css('border-radius', '0.5rem')
  $(elm).css('font-family', '"Cica"')
})
---

<BaseLayout>
  <section class="mx-8 sm:mx-10">
    <Breadcrumbs placeholder={blog.title} />
    <h1 class="text-3xl">{blog.title}</h1>
    <img src={blog.eyecatch?.url ? blog.eyecatch.url : ""} alt={blog.title} class="rounded-lg"/>
    <time datetime={blog.publishedAt}>
      {new Date(blog.publishedAt).toLocaleDateString("ja-JP")}
    </time>
    <p>
      最終更新日：<time datetime={blog.publishedAt}>
        {new Date(blog.publishedAt).toLocaleDateString("ja-JP")}
      </time>
    </p>
    <hr />
    <main set:html={$.html()} />
  </section>
</BaseLayout>
